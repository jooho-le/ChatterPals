<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="popup.css">
</head>
<body>

<div id="popup-view" class="container" style="display: none;">
    <div class="popup-control">
        <h3>플로팅 버튼 표시</h3>
        <label class="switch"><input type="checkbox" id="toggleButton"><span class="slider"></span></label>
        <p id="statusText"></p>
    </div>
</div>

<div id="sidebar-view" class="container" style="display: none;">
    <div class="header-actions">
        <button id="close-sidebar-btn" class="close-btn">✖</button>
        <a href="http://localhost:5173/" target="_blank" class="homepage-link">🏠 홈페이지로 이동</a>
    </div>

    <div class="section account-section" id="account-section">
        <div id="account-signed-in" style="display:none;">
            <p class="account-greeting">안녕하세요, <span id="account-nickname"></span>님</p>
            <button id="logoutBtn" class="btn btn-outline">로그아웃</button>
        </div>
        <form id="login-form" class="account-form" autocomplete="off">
            <h3 class="section-title">로그인</h3>
            <label class="field">
                <span>아이디</span>
                <input id="login-username" type="text" name="username" required minlength="3" />
            </label>
            <label class="field">
                <span>비밀번호</span>
                <input id="login-password" type="password" name="password" required />
            </label>
            <button type="submit" class="btn btn-primary">로그인</button>
            <p id="login-status" class="hint"></p>
        </form>
    </div>

    <div id="summary-view" class="section" style="display: none;">
        <h3 class="section-title">AI 요약</h3>
        <div id="summary" class="summary-box"></div>
        <div id="topics" class="topics-box"></div>
    </div>

    <div class="section">
        <h3 class="section-title">화면 질문 생성</h3>
        <div class="row button-group">
            <button id="question">선택 텍스트 분석</button>
            <button id="analyzeAll">전체 화면 분석</button>
            <button id="chatStart">💬 토론 시작</button>
            <select id="question-count-select">
                <option value="1">질문 1개</option>
                <option value="2">질문 2개</option>
                <option value="3" selected>질문 3개</option>
                <option value="4">질문 4개</option>
                <option value="5">질문 5개</option>
            </select>
        </div>
        <div class="row">
            <div id="result" class="result-box">Ready.</div>
        </div>
        <div class="row">
            <div id="questions" class="questions-container"></div>
        </div>
        <div class="row button-group" id="action-buttons" style="display: none;">
             <button id="evaluateBtn">🤖 답변 평가받기</button>
             <button id="saveBtn" disabled>💾 평가 결과 저장</button>
        </div>
    </div>

    <div id="chat" class="section" style="display:none;">
        <h4 class="section-title">Discuss</h4>
        <div class="chat-meta">
            <div>세션: <code id="sid">-</code></div>
            <label class="chat-limit">
                질문 수 설정
                <select id="chat-question-limit">
                    <option value="3">3개</option>
                    <option value="5" selected>5개</option>
                    <option value="7">7개</option>
                    <option value="10">10개</option>
                </select>
            </label>
        </div>
        <div class="chat-status">AI: <span id="q">(없음)</span></div>
        <div class="row input-group">
          <input id="answer" type="text" placeholder="영어로 답변" />
          <button id="send">Send</button>
        </div>
        <div class="row chat-actions">
            <button id="chatEnd" class="btn btn-danger" style="display:none;">🛑 조기 종료</button>
        </div>
        <div id="chat-evaluation" class="discussion-eval" style="display:none;">
            <h5>AI 평가</h5>
            <div class="eval-scores">
                <span>문법: <strong id="chat-grammar-score">-</strong></span>
                <span>어휘: <strong id="chat-vocab-score">-</strong></span>
                <span>논리: <strong id="chat-clarity-score">-</strong></span>
            </div>
            <p id="chat-feedback"></p>
        </div>
    </div>

    <hr class="divider">

    <div class="section">
        <h3 class="section-title">AI 음성 대화</h3>
        <div class="row button-group">
            <button id="recordBtn">🎤 말하기 시작</button>
        </div>
        <div class="voice-result-container">
             <p><strong>나:</strong> <span id="userTranscript">...</span></p>
             <p><strong>AI:</strong> <span id="aiResponse">...</span></p>
             <audio id="ai-audio-player" controls style="display: none;"></audio>
             <p class="voice-status"><small id="voiceStatus">버튼을 눌러 대화를 시작하세요.</small></p>
        </div>
    </div>
</div>

<script src="popup.js"></script>
</body>
</html>
